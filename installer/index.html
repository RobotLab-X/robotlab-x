<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RobotLab-X Installer</title>
  <style>
    body {
      background-color: #A85810;
      color: #000;
      font-family: Arial, sans-serif;
    }

    button,
    select {
      border: 2px solid #D2B48C;
      cursor: pointer;
      background-color: #80888a;
      color: #000;
      height: 40px;
      border-radius: 8px;
    }

    pre {
      max-height: 150px;
      /* Maximum height before scrolling */
      max-width: 100%;
      /* Set the maximum width to the table cell width */
      overflow: auto;
      /* Enable both horizontal and vertical scrollbars */
      background-color: #A85810;
      /* Match the background color of the body */
      color: #000;
      /* Ensure text is readable */
      padding: 10px;
      border: none;
      /* Remove white outline */
      white-space: pre-wrap;
      /* Preserve whitespace and allow text to wrap */
    }

    #install-btn {
      display: none;
      /* Hidden initially */
    }

    /* Scrollbar styles */
    pre::-webkit-scrollbar {
      width: 12px;
      /* Set the width of the scrollbar */
      height: 12px;
      /* Set the height for horizontal scrollbar */
    }

    pre::-webkit-scrollbar-track {
      background: #A85810;
      /* Match the background color of the body */
    }

    pre::-webkit-scrollbar-thumb {
      background-color: #80888a;
      /* The color of the draggable part of the scrollbar */
      border-radius: 10px;
      /* Round the scrollbar thumb */
      border: 3px solid #A85810;
      /* Add space between thumb and track */
    }
  </style>
</head>

<body>

  <table border="1" width="100%">
    <tr>
      <td width="300" rowspan="2">
        <img src="icon.png" alt="RobotLab-X" width="300" />
      </td>
      <td colspan="3" valign="top">
        <h1 id="title">RobotLab-X Installer</h1>

        <pre id="output"></pre><br />
      </td>
    </tr>
    <tr>
      <td colspan="3">Progress bar here</td>
    </tr>
    <tr>
      <td><button id="choose-dir" class="full-width">Choose Install Directory</button></td>
      <td colspan="2"><span class="info" id="selected-directory">No Directory Selected</span></td>
      <td><button id="install-btn" class="full-width" disabled>Install</button></td>
    </tr>
    <tr>
      <td></td>
      <td colspan="3" align="center"><small>v 0.0.9</small></td>
    </tr>
  </table>

  <script>
    const { ipcRenderer } = require('electron');
    const output = document.getElementById('output');
    const chooseDirButton = document.getElementById('choose-dir');
    const selectedDirectory = document.getElementById('selected-directory');
    const installButton = document.getElementById('install-btn');

    let currentDirectory = null;

    function checkInstallButton() {
      if (currentDirectory) {
        installButton.disabled = false;
        installButton.style.display = 'block'; // Show install button when directory is selected
      } else {
        installButton.disabled = true;
        installButton.style.display = 'none'; // Hide install button
      }
    }

    chooseDirButton.addEventListener('click', () => {
      ipcRenderer.send('choose-directory');
    });

    ipcRenderer.on('directory-selected', (event, directory) => {
      currentDirectory = directory;
      selectedDirectory.textContent = `${directory}`;
      checkInstallButton();
    });

    ipcRenderer.on('install-output', (event, data) => {
      output.textContent += data + '\n';
    });

    ipcRenderer.on('install-error', (event, error) => {
      output.textContent += 'Error: ' + error + '\n';
    });

    installButton.addEventListener('click', () => {
      output.textContent += 'Install button clicked!\n';
      installButton.disabled = true;
      ipcRenderer.send('install-package', { installDir: currentDirectory });
    });

    ipcRenderer.on('install-complete', () => {
      installButton.disabled = false;
      output.textContent += 'Installation completed!\n';
    });

    function scrollToBottom() {
      output.scrollTop = output.scrollHeight;
    }

    ipcRenderer.on('install-output', (event, data) => {
      output.textContent += data + '\n';
      scrollToBottom(); // Scroll to bottom after new data
    });

    ipcRenderer.on('install-error', (event, error) => {
      output.textContent += 'Error: ' + error + '\n';
      scrollToBottom(); // Scroll to bottom after new error
    });

    installButton.addEventListener('click', () => {
      output.textContent += 'Install button clicked!\n';
      installButton.disabled = true;
      ipcRenderer.send('install-package', { installDir: currentDirectory });
      scrollToBottom(); // Scroll to bottom after button click
    });

    ipcRenderer.on('install-complete', () => {
      installButton.disabled = false;
      output.textContent += 'Installation completed!\n';
      scrollToBottom(); // Scroll to bottom after install completion
    });


  </script>
</body>

</html>
