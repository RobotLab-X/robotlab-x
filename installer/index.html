<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RobotLab-X Installer</title>
  <style>
    body {
      background-color: #A85810;
      color: #000;
      font-family: Arial, sans-serif;
      /* Off-black color */
    }

    button,
    select {
      border: 2px solid #D2B48C;
      /* Blue border */
      cursor: pointer;
      background-color: #80888a;
      color: #000;
      height: 40px;
      border-radius: 8px;
    }
  </style>
</head>

<body>

  <table border="1" width="100%">
    <tr>
      <td>
        <img src="icon.png" alt="RobotLab-X" width="300" />
      </td>
      <td colspan="3" valign="top">
        <h1 id="title">RobotLab-X Installer</h1>
        <h3>v 0.0.9</h3>
        <pre id="output"></pre>




      </td>
    </tr>
    <tr>
      <td><button id="choose-dir" class="full-width">Choose Install Directory</button></td>
      <td colspan="2"><span class="info" id="selected-directory">No Directory Selected</span></td>
      <td> <button id="install-btn" class="full-width" disabled>Install</button></td>
    </tr>
  </table>

  <script>
    const { ipcRenderer } = require('electron');
    const output = document.getElementById('output');
    const versionSelect = document.getElementById('version-select');
    const chooseDirButton = document.getElementById('choose-dir');
    const selectedVersion = document.getElementById('selected-version');
    const selectedDirectory = document.getElementById('selected-directory');
    const installButton = document.getElementById('install-btn');
    const titleElement = document.getElementById('title');
    const systemDetailsElement = document.getElementById('system-details');

    let currentVersion = null;
    let currentDirectory = null;

    function checkInstallButton() {
      if (currentVersion && currentDirectory) {
        installButton.disabled = false;
      } else {
        installButton.disabled = true;
      }
    }

    ipcRenderer.on('set-version', (event, version) => {
      titleElement.textContent = `RobotLab-X Installer`;
      currentVersion = version;
      selectedVersion.textContent = `${version}`;
      checkInstallButton();
    });

    ipcRenderer.on('set-versions', (event, versions) => {
      versions.forEach(version => {
        const option = document.createElement('option');
        option.value = version;
        option.textContent = version;
        versionSelect.appendChild(option);
      });

      versionSelect.addEventListener('change', () => {
        currentVersion = versionSelect.value;
        selectedVersion.textContent = `${currentVersion}`;
        checkInstallButton();
      });
    });

    chooseDirButton.addEventListener('click', () => {
      ipcRenderer.send('choose-directory');
    });

    ipcRenderer.on('directory-selected', (event, directory) => {
      currentDirectory = directory;
      selectedDirectory.textContent = `${directory}`;
      checkInstallButton();
    });

    ipcRenderer.on('install-output', (event, data) => {
      output.textContent += data + '\n';
    });

    ipcRenderer.on('install-error', (event, error) => {
      output.textContent += 'Error: ' + error + '\n';
    });

    ipcRenderer.on('system-details', (event, systemDetails) => {
      systemDetailsElement.textContent = JSON.stringify(systemDetails, null, 2);
    });

    installButton.addEventListener('click', () => {
      console.log('Install button clicked!');
      output.textContent += 'Install button clicked!\n';
      installButton.disabled = true;
      ipcRenderer.send('install-package', { packageName: currentVersion, installDir: currentDirectory });
    });

    ipcRenderer.on('install-complete', () => {
      installButton.disabled = false;
      output.textContent += 'Installation completed!\n';
    });
  </script>
</body>

</html>
