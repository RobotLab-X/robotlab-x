name: Main Build Workflow

on:
  push:
    branches:
      - main

jobs:
  generate-version:
    runs-on: ubuntu-latest
    outputs:
      version: ${{ steps.set-version.outputs.version }}
    steps:
      - name: Generate Version Number
        id: set-version
        run: |
          VERSION="0.9.${{ github.run_number }}"
          echo "version=$VERSION" >> $GITHUB_ENV
          echo "Generated version: $VERSION"
        # Output the version to stdout and to the job output
        shell: bash
      - name: Set version output
        run: echo "::set-output name=version::$VERSION"
        shell: bash


  build-linux:
    needs: generate-version
    uses: ./.github/workflows/build-linux.yml
    with:
      version: ${{ needs.generate-version.outputs.version }}

  # build-windows:
  #   needs: generate-version
  #   uses: ./.github/workflows/build-win.yml
  #   with:
  #     version: ${{ needs.generate-version.outputs.version }}
